# Formal Modeling and Analysis of the AFDX Frame Management Design

> 译文仓库：https://github.com/LauZyHou/Papers2Chinese
> 库内编号：2

## 摘要

航空电子全双工交换以太网（AFDX）的开发旨在在飞机内部通信中提供可靠的数据交换，并具有强大的数据传输时间保证。 AFDX设计基于具有物理冗余链路的交换网络的原理，以支持可用性并容忍网络中的传输和链路故障。

在这项工作中，我们开发了AFDX框架管理的正式模型，以确定设计的可靠性。 为了捕获精确的时间语义，我们将系统建模为定时自动机网络，并使用UPPAAL进行模型检查以检查CTL中表示的所需属性。 我们的分析表明，AFDX帧管理的设计容易受到诸如网络冒泡之类的故障的影响，这些故障可能会触发不必要的系统重置。 我们表明，可以通过修改原始设计以在接收器处存储帧的优先级队列来缓解这些问题。 我们还建议传达重置消息的冗余副本，以实现对网络冒泡的容忍度。

# 1 介绍

一般的控制系统，尤其是航空电子系统，都依赖及时地从源头到接收器的完整而最新的数据。对于安全关键型系统，可靠的实时通信链接至关重要。航空电子全双工交换以太网（AFDX）[3]已经开发出来，可以满足商用飞机应用的这些要求。 AFDX是IEEE802.3标准以太网[9]的标准版本的子集，具有关键的增强功能，可提供确定的定时和可靠的消息传递。确定性定时是通过具有有限带宽和帧传递间隔的虚拟链路（VL）上的通信来实现的。通过冗余通道进行通信可实现消息的可靠传递。框架管理机制负责在将消息传递到应用程序之前检查消息帧的完整性并管理冗余。因此，框架管理是AFDX设计的重要组成部分，必须针对设计规则进行保证。

在这项工作中，我们开发了AFDX框架管理的正式模型，分析并验证了在不同类型的网络故障下是否满足要求规范。在开发框架管理的正式模型时，我们使用定时自动机[1]，它可以定量捕获时间信息。我们的特定模型由定时自动机网络组成，该网络具有一个发送端系统，两个通信通道和一个接收端系统。该系统在UPPAAL [5]中进行了描述，该模型支持在CTL中指定的模型检查属性。从我们的分析中发现，该设计很容易出现故障，例如网络故障，如果它们乱序出现，则会导致不必要的重置和丢帧。为了充分利用消息中的冗余并使用此冗余来检测故障，我们建议在接收方包括一个优先级队列。这将有助于检测通道上的网络故障，即使帧顺序混乱也可以按顺序将帧发送给应用程序。为了降低错误重置的可能性，我们建议传达重置消息的冗余副本。这些修改可以轻松地合并到原始设计中，并为AFDX帧管理提供更高的可靠性。

本文的主要内容如下：第3节介绍AFDX和帧管理，第4节介绍系统的定时自动机模型，第5节介绍分析和结果。 最后，我们在第6节中提出修改，并在第7节中得出结论。

# 2 之前的工作

ARINC-664 [2]是航空电子通信体系结构的商业标准。 AFDX [3]是该标准的供应商特定实现。它基于802.3标准以太网，并进行了增强以确保确定性和可靠性。在[10]中确定了交换式以太网航空电子网络的概述以及测试挑战。尽管他们的工作集中于通过仿真对各种模块进行硬件测试，但我们的重点是在不同故障下对设计进行正式建模和分析。我们的模型是使用UPPAAL开发的，UPPAAL是一种免费工具，可以使用定时自动机的各种功能进行建模，称为定时安全自动机[7]。 UPPAAL中的建模语言建立在定时自动机模型的基础上，提供了有用的扩展，例如整数变量，广播频道，紧急位置和已提交位置等。UPPAAL中的模型检查器允许使用简化版本的CTL指定查询，该查询语言由CTL组成路径和状态公式，但是路径公式不能嵌套。关于UPPAAL中协议的建模和验证，已有大量文献提供（c.f.，[6，8，12]）。

# 3 AFDX和帧管理

AFDX网络的主要元素是终端系统，交换机和链接。终端系统（ES）的功能是提供服务，以确保与分区软件进行安全可靠的数据交换。每个终端系统都直接与交换机建立双向连接。可能会有多个这样的连接用于冗余通信。交换网络可确保将数据从一个终端系统移动到另一终端系统所需的连接和带宽可用。服务质量（QoS）提供了一种对流量进行分类的方法，并确保特定种类的流量将始终在其有权获得的服务级别上流经网络，而与竞争需求无关。对于飞机网络，无论数据类型如何，都必须满足每个网络传输请求，并且必须确保最大的网络传输延迟（称为端到端延迟（L））。有保证的服务可提供可靠的，数学上可证明的端到端上限。

虚拟链路（VL）是以太网协议的基础。 每个VL定义了从一个源终端系统到潜在的多个目标终端系统的单向连接，通过该连接可以交换数据帧。 链路上的数据流由终端系统根据带宽分配GAP（BAG）控制。 BAG值是终端系统分配的时间片，并由终端系统为VL传输数据。 这些时间以毫秒为单位，通常为2的幂。

通过利用冗余链接，可以确保AFDX设计中可靠的帧传送。 网络冗余的基本概念如图3所示。终端系统通过多个通信通道进行通信，从而可以保护通信以防丢失一个完整的网络。

冗余方案按以下方式在每个链路上运行：发送端系统准备一些数据并将其传递给通信协议堆栈。 在此，将序列号添加到每个帧，以使接收功能能够在传输到接收分区之前重建帧的单个有序流而无需重复。 序列号是一个八位字节长，范围从0到255，并且在每个连续帧中递增。 255之后，序列号将缠绕到1。序列号0保留用于传递复位。 这样，分区就不会意识到底层的网络冗余，并且可以在通信堆栈和利用网络服务的分区之间建立一个简单的接口。

在默认模式下，每个帧都通过两个网络发送，并且冗余在接收端系统中进行。 为了简化接收端系统的算法，应在0.5 ms的最大时间差内发送帧的冗余副本。 接收时，通信堆栈（IP层以下）中的算法使用“首次有效获胜”策略。 这意味着将接受来自任一网络的具有下一个有效序列号的第一个帧，并将其沿堆栈向上传递到接收分区。 当接收到具有该序列号的第二帧时，将其简单地丢弃。 如下面的图3中所示的帧流所示，在完整性检查（IC）之后放置了冗余管理（RM）。

在无故障的网络操作下，IC会针对每个网络独立地将其接收到的帧传递到RM。 如果存在故障（基于序列号），则IC的任务是消除无效帧，并相应地通知网络管理。 对于每个网络，IC都会在以下间隔中测试每个帧的序列号：[PSN 1，PSN 2]，其中前一序列号（PSN）是在此VL上接收到（但不一定转发）的前一帧的序列号。 运算符⊕将序列号的折回考虑在内。 因此，例如，如果PSN = 254，则PSN⊕1= 255且PSN⊕2= 1

AFDX冗余管理的功能仅仅是消除作为已传递到分区的帧的冗余副本的帧。RM假定网络运行正常，尤其是已验证确定性。 RM配置通常基于SkewMax参数：即两个冗余帧的接收之间的最长时间。 该值取决于网络拓扑（框架交叉的交换机数量），并且应由系统集成商提供。 SkewMax值（以ms表示）由配置VL给出。